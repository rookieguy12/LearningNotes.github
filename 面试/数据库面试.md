# 数据库面试

## SQL

1. 介绍下数据库分页

   + MySQL分页语法

     + 默认情况下SELECT返回所有匹配行，而使用LIMIT，可以进行分页查询

     + LIMIT优化

       + 当偏移量很大的时候，比如LIMIT 10000， 20。应尽可能用索引覆盖扫描，或者是已知位置的查询

         ```mysql
         SELECT film_id,description FROM sakila.film ORDER BY title LIMIT 50,5;
         
         #换为索引覆盖扫描
         SELECT film.film_id,film.description  FROM sakila.film INNER JOIN (SELECT film_id FROM sakila.film ORDER BY title LIMIT 50,5 ) AS lim USING(film_id);
         
         #转为已知位置的查询
         SELECT film_id,description FROM skila.film WHERE position BETWEEN 50 AND 54 ORDER BY position;
         ```

2. 介绍一下SQL中的聚合函数

   ```mysql
   COUNT()统计数据表中记录的行的总数
   COUNT(*)不论是不是空，都统计
   COUNT(字段)是计算指定列的非空的行数
   
   AVG()计算平均值
   
   SUM()计算和
   
   MAX()返回指定列的最大值
   
   MIN()返回指定列的最小值
   ```

3. 表和表的关联
   + 内连接
     + INNER JOIN，返回满足条件的连接数据
   + 外连接
     + 左外连接LEFT OUTER JOIN，返回左表中的所有记录和右表中满足连接条件的记录
     + 右外连接RIGHT OUTER JOIN
   + 等值连接
     + 这主要是靠WHERE完成的，效果等同于内连接，一般也更建议用内连接而非等值连接
   + 当然，从表的关系上说，常见的关联关系有：一对多关联、多对多关联、自关联
     + 一对多关联：主要是主表的主键关联从表的外键
     + 多对多关联：有时需要中间表来关联，中间表存储两张表的主键。与两张表各自形成一对多关联。
     + 自关联：就是一张与自己相关联的表，在关联时可通过别名将它们当作两表来看待。

4. 怎么将行转换为列？

   + ![](Pictures/26.png)

     ![](pictures/27.png)

     ```mysql
     SELECT userid, 
     SUM(CASE `subject` WHEN '语文' THEN score ELSE 0 END) as '语文', 
     SUM(CASE `subject` WHEN '数学' THEN score ELSE 0 END) as '数学', 
     SUM(CASE `subject` WHEN '英语' THEN score ELSE 0 END) as '英语', 
     SUM(CASE `subject` WHEN '政治' THEN score ELSE 0 END) as '政治'  FROM tb_score  GROUP BY userid
     ```

     ```mysql
     #也可改用if
     SELECT userid, SUM(IF(`subject`='语文',score,0)) as '语文', SUM(IF(`subject`='数学',score,0)) as '数学', SUM(IF(`subject`='英语',score,0)) as '英语', SUM(IF(`subject`='政治',score,0)) as '政治'  FROM tb_score  GROUP BY userid
     ```

5. SQL注入
   + 原理就是将SQL代码伪装到输入参数中，传递到Server解析并执行的一种手段。
   + 如何解决SQL注入
     + 严格参数校验
       + 不让不该出现的字符出现
     + SQL预编译
       + MySQL server在启动时，client先把语句模板发到服务器，空位直接用占位符，server服务器对SQL语句模板进行编译，编译之后根据语句的优化分析对相应的索引进行优化，在最终绑定参数时把相应的参数传送给MySQL服务器，直接进行执行，节省了SQL查询时间，以及MySQL服务器的资源，达到一次编译、多次执行的目的，除此之外，还可以防止SQL注入。
       + 具体是怎样防止SQL注入的呢？实际上当将绑定的参数传到MySQL服务器，MySQL服务器对参数进行编译，即填充到相应的占位符的过程中，做了转义操作。我们常用的JDBC就有预编译功能，不仅提升性能，而且防止SQL注入。

6. Where和having的区别
   + WHERE是约束声明，在结果返回前作用，不能用聚合函数
   + HAVING是过滤声明，在结果返回后对结果进行过滤，可以使用聚合函数，但不能使用除了分组字段和聚合函数之外的其他字段。
     + 如果使用了分组字段作为过滤条件，就应该替换为WHERE子句

## 索引

1. 什么是索引
   + 索引是一个单独的、存储在磁盘上的数据库结构，**包含着对数据表里所有记录的引用指针**。
   + 使用索引**可以快速找出在某个或多个列中有一特定值的行**
   + 所有MySQL列类型都可以被索引，对相关列使用索引是提高查询操作速度的最佳途径。
   + 索引是在存储引擎中实现的，因此，每种存储引擎的索引都不一定完全相同，并且每种存储引擎也不一定支持所有索引类型。
   + MySQL中索引的存储类型有两种，即BTREE和HASH，具体和表的存储引擎相关。MyISAM和InnoDB存储引擎只支持BTREE索引；MEMORY/HEAP存储引擎可以支持HASH和BTREE索引。

2. 索引的优缺点
   + 优点
     + 创建唯一索引，可以保证数据库表中每一行数据的唯一性。
     + 加快数据的查询速度
     + 实现数据的参考完整性方面，可以加速表和表之间的连接
     + 使用分组和排序子句进行数据查询时，也可以显著减少查询中分组和排序的时间。
   + 缺点
     + 创建索引和维护索引要耗费时间，并且随着数据量的增加所耗费的时间也会增加。
     + 索引需要占磁盘空间，除了数据表占数据空间之外，每一个索引还要占一定的物理空间，如果有大量的索引，索引文件可能比数据文件更快达到最大文件尺寸。
     + 对表中的数据进行增加、删除和修改的时候，索引也要动态地维护，这样就降低了数据的维护速度
3. 索引的分类
   + 普通索引、唯一索引、主键索引
     + 普通索引允许重复和NULL
     + 唯一索引不允许重复
     + 主键索引不允许NULL
   + 单列索引和组合索引
     + 单列就是只包含一个列
     + 组合则是多个字段的
   + 全文索引
     + FULLTEXT，可以在CHAR,VARCHAR,TEXT类型上创建，支持值的全文查找
     + 允许重复和NULL
   + 空间索引

































































































## 事务



## 锁



## 其它

