# 场景设计题

### 海量并发、分布式架构和一致性问题

1. 让你设计一个微信朋友圈，怎么设计数据结构？
2. 如何设计排名系统？
   + 基本的解决方案发展：
     + 直接将val存到持久性数据库里面，每次要得到排名就查数据库。显然，延迟很高。
     + 采用memcache优化，但是如果要求实时得到排名，则会花费很多时间去计算，计算的时间复杂度为O(n)，也没法采用定时更新的办法，而且数据还容易丢失。
     + 改用二叉树、红黑树、B+树等优化计算与存储。存储的时候，用hash，存放key为id，val为socre的一个表，再建立一个rb tree，存放了分数和左子树的元素个数，时间复杂度为O(nlogn)，而在计算一个人的排名的时候降低到O(logn)
     + 接着又有问题了，由于树的更新和修改肯定是必须保证线程安全的，这就导致性能其实并没那么高，如果每次操作都得
     + 

## 小总结

+ 很多问题在设计上都是相通的，而有些问题的解决思路又伴随新问题的产生
  + 高并发性的要求和单一线程效率低下的问题
    + 为了提高并发能力，一个思路可以是分解功能，解耦功能，将功能拆分到不同模块去完成，原本可能一个操作既有计算，又有I/O，这样之后，既然功能专一了，在细粒度的功能上，就可以考虑并发完成。
      + 一个例子是所谓消息队列机制。原本的一个系统，可能单线程的接收并处理这样的I/O需求，那么可以将接收和处理进行分离，让消息队列完成接收功能，那么对于处理，则可以使用并发机制实现。
  + 分布式架构的一致性问题

