# 计算机系统

#### 程序从代码到可执行程序的过程

1. 基本过程：预处理，编译，汇编，链接
2. 流程简介：
   + 预处理：将所有的#include头文件以及宏定义替换成其真正的内容。.c得到.i文件
   + 编译：将经过预处理之后的程序转换成汇编代码(assembly code)的过程。.i得到.s文件
   + 汇编：汇编代码转换成机器码，得到二进制目标文件。.s得到.o
   + 链接：将多个目标文件以及所需的库文件(.so等)链接成最终的可执行文件(executable file)。

#### 动态链接和静态链接的区别联系

1. 静态链接是在程序执行前进行链接，生成一个可执行目标文件。而动态链接是在程序执行过程中进行链接。
2. 动态链接库在生成可执行文件时，如果发现引用的外部函数是一个动态链接符号，就不重定位，而留到装载过程进行。
3. 静态链接库的缺点：

+ 浪费空间。当一个lib有多个函数但只使用了其中的某几个时，就可能链接了不必要使用的函数，造成不必要的浪费。

  让一个lib只包含一个函数，可以减少浪费。这一点和设计模式里的接口隔离很像。

  还有就是多个程序使用了同一个函数时，两者都得链接一次，导致可执行文件有它的多个副本。

+ 更新困难。每当静态库改变时，就得重新编译链接。

4. 动态链接库的优点：

+ 节省空间。动态链接的基本思想是把程序按照模块拆分成各个相对独立部分，在程序运行时才将它们链接在一起形成一个完整的程序，即使需要每个程序都依赖同一个库，但是该库不会像静态链接那样在内存中存在多份。
+ 更新方便。更新时只要替换原来的目标文件，而无需将所有的程序重新链接。

